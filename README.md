# RegEnterprise

Консольное приложение для ведения реестра предприятий с поддержкой управления ассортиментом, отделами сбыта и банковскими реквизитами. Проект реализован на C++ с использованием ODBC для взаимодействия с реляционной СУБД (предположительно PostgreSQL) и предоставляет удобный текстовый интерфейс для администрирования данных.

## Описание задачи

Приложение позволяет:

- Управлять справочником предприятий с указанием организационно-правовой и формы собственности, ИНН, адреса
- Вести каталог товаров с категориями, сроками хранения и условиями поставки
- Настраивать индивидуальный ассортимент предприятий с оптовыми ценами
- Назначать отделы сбыта предприятиям (по одному на предприятие)
- Хранить банковские реквизиты предприятий (по одному набору на предприятие)

Все сущности связаны через внешние ключи, обеспечивая целостность данных. При удалении предприятия автоматически удаляются связанные записи (ассортимент, отдел сбыта, банковские реквизиты) благодаря ON DELETE CASCADE.

## Особенности реализации

- Архитектура на основе паттерна Table Data Gateway — каждый тип сущности имеет свой шлюз (*Gateway)
- Безопасная работа с SQL через экранирование строк (escape()) и оборачивание в кавычки (quote())
- Поддержка страничной навигации при выводе списков (предприятий, товаров и т.д.)
- Корректная обработка UTF-8 при выводе таблиц (подсчёт визуальной ширины строк)
- Валидация обязательных полей и уникальности (например, ИНН или связь «один к одному» для отдела сбыта и реквизитов)
- Автоматическое создание всех необходимых таблиц и справочников при запуске
- Человеко-ориентированный CLI с логической нумерацией записей (пользователь работает с номерами, а не ID)

### Схема БД:
![alt text](<Схема bd_ent.png>)

### Схема отображения классов в реляционную модель:
![alt text](image.png)

## Структура проекта

- `src/` - исходные коды
- `include/` - заголовочные файлы
- `bin/` - исполняемые файлы
- `CMake-build/` - артефакты сборки CMake (включая идентификатор компилятора)
- `CMakeLists.txt` - конфигурация сборки (предполагается)

## Как собрать весь проект
```bash
./build.sh
```

или в директории RegEnterprise/CMake-build/ выполнить комманды:
```bash
cmake ..
make
```

После сборки в папке RegEnterprise/bin/ появится бинарный файл с названием `RegEnterprise`.

Для корректной сборки требуется установленный ODBC-драйвер и настроенное DSN-соединение (по умолчанию используется rab_dsn с логином rab и паролем 1111).

## Как запустить
Наилучшим вариантом для запуска будет наличие файла .odbc.ini с подобным содержимым:
```bash
[rab_dsn]
Description = Реестр предприятий — PostgreSQL
Driver = PostgreSQL Unicode
Database = bd_ent
Servername = localhost
UserName = rab
Password = 1111
Port = 5432
```

В таком случае после сбори кроекта достаточно выполнить для запуска:

```bash
ODBCINI="./.odbc.ini" ./bin/RegEnterprise
```

При первом запуске приложение:

- Подключится к БД через ODBC
- Создаст все необходимые таблицы и справочники (enterprise, product, ownership_form, legal_form, product_category, delivery_terms, enterprise_product, sales_department, bank_details)
- Запустит главное меню

## Основные возможности интерфейса
### Главное меню

- Управление предприятиями
- Управление товарами
- Управление ассортиментом предприятий
- Управление отделами сбыта
- Управление банковскими реквизитами
- Выход

### Для предприятий и товаров

- Просмотр (с пагинацией)
- Добавление
- Редактирование (с возможностью оставить поле без изменений)
- Удаление (с подтверждением)

### Для ассортимента

- Привязка товара к предприятию с указанием оптовой цены
- Отвязка товара
- Изменение оптовой цены

### Для отделов сбыта и банковских реквизитов
- Привязка только к предприятиям, у которых ещё нет такой записи (ограничение «один к одному»)
- Возможность смены предприятия при редактировании (с учётом уникальности)

## Требования
- Компилятор C++ с поддержкой C++11 или выше
- Библиотека unixODBC (или другая реализация ODBC)
- Настроенное ODBC-соединение (DSN) к PostgreSQL (или другой СУБД, поддерживающей синтаксис SERIAL, REFERENCES, ON DELETE CASCADE)
- Linux (рекомендуется), Windows или macOS с поддержкой ODBC

## Предостережения
- Приложение не использует параметризованные запросы, а полагается на ручную экранизацию (escape()), что теоретически может быть уязвимо при некорректной реализации экранирования.
- Для работы требуется предварительная настройка DSN в системе.
- Все цены хранятся как NUMERIC(12,2) — поддержка дробных значений с двумя знаками после запятой.
- Справочники (legal_form, ownership_form и др.) создаются автоматически, но изначально пусты — их нужно заполнять отдельно (в текущей версии CLI не предоставляет интерфейс для управления справочниками). Для их заполнения можно использовать приложение fill_dicts из проекта Generator.

Проект демонстрирует чистую архитектуру доступа к данным и удобный консольный интерфейс для управления сложной предметной областью.
